!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.patch2dom=t()}(this,function(){"use strict";var u=1,s=3,n=Array.isArray;function c(a,e){var t=[];e.forEach(function(e){e&&e.domkey&&t.push(e.domkey)});for(var l=Object.create(null),r=a.firstChild;r;r=r.nextSibling){var n=f(r);n&&(0<=t.indexOf(n)?l[n]=r:a.removeChild(r))}var d=a.firstChild;for(var i in e.forEach(function(e){var t,r,n,i=typeof e;if("string"===i||"number"===i)d?d.nodeType===s?(d.nodeValue=e,d=d.nextSibling):a.insertBefore(document.createTextNode(e),d):a.appendChild(document.createTextNode(e));else if((n=e)&&Object.getPrototypeOf(n)===Object.prototype){var o=e.domkey,f=o?l[o]:null;if(f)delete l[o],f===d?d=d.nextSibling:a.insertBefore(f,d),m(f,e.attrs),c(f,e.children);else if(d)if(o)a.insertBefore(h(e),d);else for(;;){if(!d){a.appendChild(h(e));break}if(!p(l,d)){r=e,(t=d).nodeType===u&&t.nodeName.toLowerCase()===r.name.toLowerCase()?(m(d,e.attrs),c(d,e.children),d=d.nextSibling):a.insertBefore(h(e),d);break}d=d.nextSibling}else a.appendChild(h(e))}}),l)a.removeChild(l[i]);for(var o=a.childNodes.length-e.length;0<=--o;)a.removeChild(a.lastChild)}function h(e){var t=document.createElement(e.name);return m(t,e.attrs),c(t,e.children),t}function m(n,i){for(var e=n.attributes,t=e.length-1;0<=t;t-=1){var r=e[t].name;i.hasOwnProperty(r)&&null!=i[r]||n.removeAttribute(r)}Object.getOwnPropertyNames(i).forEach(function(e){var t=i[e],r=typeof t;e in n?!0===(n[e]=t)&&n.setAttribute(e.toLowerCase(),""):"function"===r||"o"===e[0]&&"n"===e[1]?n[e]=t:"boolean"===r?!0===t?n.setAttribute(e,""):n.removeAttribute(e):null==t?n.removeAttribute(e):n.setAttribute(e,t)})}function f(e){if(e.nodeType===u)return e.getAttribute("domkey")}function p(e,t){for(var r in e)if(e[r]===t)return!0;return!1}return function(e,t){if(n(t))c(e,t);else if(null!=t)c(e,[t]);else for(var r=e.lastChild;r;)e.removeChild(r)}});
